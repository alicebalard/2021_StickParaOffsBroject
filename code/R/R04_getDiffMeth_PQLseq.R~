## Data preparation for PQLseq
## A. Balard
## 2nd of August 2024

# Each script sources the previous script of the pipeline if needed
source("R01_calculateSequencingStats.R")

## Load path for CGmap files generated by BSBolt + subselected to keep only CG methylated sites
temp = list.files(path="/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/04BSBolt_methCall/BSBolt/MethylationCalling/Methylation_calling_splitted",
                  pattern = "*_trimmed_cutadapt.fastq.gz.bam.sorted.CGmap.gz.CG.map.gz",
                  full.names = T)
length(temp) # check: must be 144

## Install PQLseq
## install.packages("PQLseq")
library(PQLseq)

## PQLseq requires four input files containing methylated read counts, total read
## counts, relatedness matrix, and predictor variable of interest

## 1. methylated count file: The first column lists site IDs while the first row lists individual IDs


load("/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/StickParaOffsBroject/gitignore/bigdata/05MethylKit/uniteCovObjects/uniteCovHALF_G1_woSexAndUnknowChr_OVERLAPwG2_20dec2022.RData")

library(dplyr)

uniteCovHALF_G1_woSexAndUnknowChrOVERLAP %>% head(10) -> test


test %>% data.frame


## CGmap is a tab separated text format describing the methylation status of observed cytosines
# Chromosome
# Nucleotide, C for reads mapped to the Watson (sense) strand and G for reads mapped to the Crick (anti-sense) strand
# Position, base-pairs from start
# Context, three base pair methylation context
# Sub-Context, two base pair methylation context
# Methylation Value, proportion of methylated bases to total bases
# Methylated Bases, methylated nucleotides observed
# All Bases, total number of nucleotides observed at the mapping position

## import files into a list (10 minutes)
# myfiles = lapply(temp, read.csv, sep="\t", header=F)

## Merge the positions watson and crick?
