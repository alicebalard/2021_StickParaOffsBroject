}
myadonisFUN(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
makeDatadistFUN <- function(dataset){
perc.meth=percMethylation(dataset)
SD=apply(perc.meth,1, sd, na.rm = TRUE)
perc.meth <- perc.meth[-which(SD<0.3),]
x=t(perc.meth)
data.dist = as.matrix((vegdist(x, "bray", upper = FALSE)))
}
myadonisFUN <- function(dataset, metadata){
data.dist = makeDatadistFUN(dataset)
perm <- how(nperm = 1000) # 1000 permutations
setBlocks(perm) <- with(metadata, Family) # define the permutation structure
print(adonis2(data.dist ~ PAT * outcome * Sex, data = metadata, permutations = perm))
print(adonis2(data.dist ~ PAT + outcome + Sex, data = metadata, permutations = perm))
}
myadonisFUN(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
data.dist = makeDatadistFUN(dataset)
myGOF.NMDS.FUN <- function(dataset){
data.dist = makeDatadistFUN(dataset)
library(goeveg)
dimcheckMDS(
data.dist,
distance = "bray",
k = 7,
trymax = 100,
autotransform = TRUE
)
abline(h = 0.1, col = "darkgreen")
}
myGOF.NMDS.FUN(dataset = uniteCovALL_woSexAndUnknowChr_OFF)
makeDatadistFUN <- function(dataset){
x=makePercentMetMat(dataset)
data.dist = as.matrix((vegdist(x, "bray", upper = FALSE)))
}
myadonisFUN <- function(dataset, metadata){
data.dist = makeDatadistFUN(dataset)
perm <- how(nperm = 1000) # 1000 permutations
setBlocks(perm) <- with(metadata, Family) # define the permutation structure considering family
print(adonis2(data.dist ~ PAT * outcome * Sex, data = metadata, permutations = perm))
print(adonis2(data.dist ~ PAT + outcome + Sex, data = metadata, permutations = perm))
}
myadonisFUN(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
makePercentMetMat <- function(dataset){
perc.meth=percMethylation(dataset)
SD=apply(perc.meth,1, sd, na.rm = TRUE)
perc.meth <- perc.meth[-which(SD<0.3),]
x=t(perc.meth)
return(x)
}
makeDatadistFUN <- function(dataset){
x=makePercentMetMat(dataset)
data.dist = as.matrix((vegdist(x, "bray", upper = FALSE)))
}
myadonisFUN <- function(dataset, metadata){
data.dist = makeDatadistFUN(dataset)
perm <- how(nperm = 1000) # 1000 permutations
setBlocks(perm) <- with(metadata, Family) # define the permutation structure considering family
print(adonis2(data.dist ~ PAT * outcome * Sex, data = metadata, permutations = perm))
print(adonis2(data.dist ~ PAT + outcome + Sex, data = metadata, permutations = perm))
}
myadonisFUN(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
?dist
myNMDSplots <- function(dataset){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot))
}
myNMDSplots <- function(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
))
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
mySEXplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "trtG1G2", find_hull)
myOFFplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=trtG1G2), alpha=0) +
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot, mySEXplot, myOFFplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
mySEXplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "outcome", find_hull)
myOFFplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=outcome), alpha=0) +
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot, mySEXplot, myOFFplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
mySEXplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "outcome", find_hull)
myOFFplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=outcome), alpha=0) +
geom_point(aes(fill=outcome, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot, mySEXplot, myOFFplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
mySEXplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "outcome", find_hull)
myOFFplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=outcome), alpha=0) +
scale_color_manual(values = c("grey","red"))+
scale_fill_manual(values = c("grey","red"))+
geom_point(aes(fill=outcome, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot, mySEXplot, myOFFplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
myNMDSplots <- function(dataset, metadata){
x=makePercentMetMat(dataset)
set.seed(2)
NMDS <- metaMDS(comm = x, distance = "bray", maxit=1000, k = 6)
mystressplot <- stressplot(NMDS)
MDS1 = NMDS$points[,1]
MDS2 = NMDS$points[,2]
NMDS2 = data.frame(MDS1 = MDS1, MDS2 = MDS2, ID = metadata$ID,
PAT=as.factor(metadata$PAT),
outcome=as.factor(metadata$outcome),
Sex = as.factor(metadata$Sex))
find_hull <- function(my_data) my_data[chull(my_data[,1], my_data[,2]), ]
hulls <- ddply(NMDS2, "PAT", find_hull)
myPATplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls, aes(col=PAT), alpha=0) +
scale_color_manual(values = c("grey","yellow"))+
scale_fill_manual(values = c("grey","yellow"))+
geom_point(aes(fill=PAT, shape=PAT), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "Sex", find_hull)
mySEXplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=Sex), alpha=0) +
scale_color_manual(values = c("red","blue"))+
scale_fill_manual(values = c("red","blue"))+
geom_point(aes(fill=Sex, shape=Sex), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
hulls2 <- ddply(NMDS2, "outcome", find_hull)
myOFFplot <- ggplot(NMDS2, aes(x=MDS1, y=MDS2)) +
geom_polygon(data = hulls2, aes(col=outcome), alpha=0) +
scale_color_manual(values = c("grey","red"))+
scale_fill_manual(values = c("grey","red"))+
geom_point(aes(fill=outcome, shape=outcome), size = 3, alpha = .6) +
scale_shape_manual(values = c(21,22)) +
theme_bw() +
theme(legend.title=element_blank(), legend.position = "top")
return(list(mystressplot, myPATplot, mySEXplot, myOFFplot))
}
myNMDSplots(dataset = uniteCovALL_woSexAndUnknowChr_OFF, metadata = fullMetadata_OFFS)
options(stringsAsFactors = FALSE);
table(fullMetadata_OFFS$trtG1G2,fullMetadata_OFFS$trtG1G2_NUM)
cov = data.frame(Family = fullMetadata_PAR$Family)
myDiffMeth=calculateDiffMeth(uniteCov2_woSexAndUnknowChr_PAR,
covariates = cov, mc.cores = 4)
fullMethylKitObj
fullMethylKitObj
head(fullMethylKitObj)
head(data(fullMethylKitOb))
