# if doesn't work we can try euclidian
P1_Dist  = vegdist(t, "bray")
#Create NMDS based on euclidian distances - metaMDS finds the most stable NMDS solution by randomly starting from different points in your data
NMDS <- metaMDS(P1_Dist, zerodist="add")
#Create NMDS based on euclidian distances - metaMDS finds the most stable NMDS solution by randomly starting from different points in your data
NMDS <- metaMDS(P1_Dist, zerodist="add")
#check to see stress of NMDS
stressplot(NMDS)
# adonis test statistics
adonis(P1_Dist ~ youngDF$population, method="euclidean",perm=999) # p=0.001
data.scores <- as.data.frame(scores(NMDS))
data.scores$id <- rownames(data.scores)
data.scores$grp<-youngDF$population
ggplot(data=data.scores) +
geom_point(aes(x=NMDS1,y=NMDS2,colour=grp)) +
theme_minimal()
ggplot(data=data.scores) +
geom_point(aes(x=NMDS1,y=NMDS2,fill=grp), pch =21) +
theme_minimal()
ggplot(data=data.scores) +
geom_point(aes(x=NMDS1,y=NMDS2,fill=grp), pch =21, alpha =.5, size =2) +
theme_minimal()
ggplot(data=data.scores) +
geom_point(aes(x=NMDS1,y=NMDS2,fill=grp), pch =21, alpha =.2, size =2) +
theme_minimal()
ggplot(data=data.scores) +
geom_point(aes(x=NMDS1,y=NMDS2,fill=grp), pch =21, alpha =.2, size =3) +
theme_minimal()
# Define a group variable (first 12 samples belong to group 1, last 12 samples to group 2)
group = c(rep("Group1", 12), rep("Group2", 12))
group
# Define a group variable (first 12 samples belong to group 1, last 12 samples to group 2)
group = youngDF$population
group
as.factor(group)
as.numeric(group)
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(data.scores, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(data.scores, type = "n")
#Create NMDS based on euclidian distances - metaMDS finds the most stable NMDS solution by randomly starting from different points in your data
NMDS <- metaMDS(P1_Dist, zerodist="add)
#Create NMDS based on euclidian distances - metaMDS finds the most stable NMDS solution by randomly starting from different points in your data
NMDS <- metaMDS(P1_Dist)
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, type = "n")
# if doesn't work we can try euclidian
P1_Dist  = vegdist(t, "euclidian")
# if doesn't work we can try euclidian
P1_Dist  = vegdist(youngDF[youngFishParas], "euclidian")
#Create NMDS based on euclidian distances - metaMDS finds the most stable NMDS solution by randomly starting from different points in your data
NMDS <- metaMDS(P1_Dist)
# species scores are in
envfit(NMDS, youngDF[youngFishParas])
#check to see stress of NMDS
stressplot(NMDS)
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(envfit(NMDS, youngDF[youngFishParas])
, type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(envfit(NMDS, youngDF[youngFishParas]) , type = "n")
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS,display = "sites", type = "n")
ggplot(data = NMDS, aes(MDS1, MDS2))
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS, display = "sites", type = "plot")
# Plot convex hulls with colors based on the group identity
ordiplot(NMDS)
pl<-ordiplot(NMDS, choices = c(2, 3), display = 'sites', type = 'n')
for(i in unique(group)) {
ordihull(NMDS3$point[grep(i, group),], draw="polygon",
groups = group[group == i],col = colors[grep(i,group)],label=F) }
ordihull(NMDS$point[grep(i, group),], draw="polygon",
groups = group[group == i],col = colors[grep(i,group)],label=F) }
orditorp(NMDS, display = "species", col = "red", air = 0.01)
####
metaMDS(youngDF[youngFishParas])
youngDF[youngFishParas]
####
metaMDS(youngDF[youngFishParas], distance = "euclidian")
####
myNMDS <- metaMDS(youngDF[youngFishParas], distance = "euclidian")
plot(myNMDS, type = "t")
# prettier with ggplot2
data.scores <- as.data.frame(scores(myNMDS))  #Using the scores function from vegan to extract the site scores and convert to a data.frame
data.scores$site <- rownames(data.scores)  # create a column of site names, from the rownames of data.scores
data.scores$grp <- youngDF$population
head(data.scores)  #look at the data
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,shape=grp,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=6,vjust=0) +  # add the site labels
scale_colour_manual(values=c("A" = "red", "B" = "blue")) +
coord_equal() +
theme_bw()
species.scores <- as.data.frame(scores(myNMDS, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
species.scores$species <- rownames(species.scores)  # create a column of species, from the rownames of species.scores
head(species.scores)  #look at the data
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,shape=grp,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=6,vjust=0) +  # add the site labels
scale_colour_manual(values=c("A" = "red", "B" = "blue")) +
coord_equal() +
theme_bw()
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,shape=grp,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=6,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,shape=grp,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
# if doesn't work we can try euclidian
P1_Dist  = vegdist(youngDF[nonUniqPar], "euclidian")
####
myNMDS <- metaMDS(youngDF[nonUniqPar], distance = "euclidian")
plot(myNMDS, type = "t")
# prettier with ggplot2
data.scores <- as.data.frame(scores(myNMDS))  #Using the scores function from vegan to extract the site scores and convert to a data.frame
data.scores$site <- rownames(data.scores)  # create a column of site names, from the rownames of data.scores
data.scores$grp <- youngDF$population
head(data.scores)  #look at the data
species.scores <- as.data.frame(scores(myNMDS, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
species.scores$species <- rownames(species.scores)  # create a column of species, from the rownames of species.scores
head(species.scores)  #look at the data
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,shape=grp,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
data.scores$grp
[data.scores$grp %in% data.scores$grp[1]
data.scores$grp %in% data.scores$grp[1]
data.scores[data.scores$grp %in% data.scores$grp[1], ][chull(data.scores[data.scores$grp %in% data.scores$grp[1], c("NMDS1", "NMDS2")]), ]
data.scores$grp
data.scores
data.scores$grp
data.scores[data.scores$grp %in% data.scores$grp[1], ][chull(data.scores[data.scores$grp %in% data.scores$grp[1], c("NMDS1", "NMDS2")]), ]
chull(data.scores[data.scores$grp %in% data.scores$grp[1], c("NMDS1", "NMDS2")]
)
data.scores[data.scores$grp %in% data.scores$grp[1], ][chull(data.scores[data.scores$grp %in% data.scores$grp[1], c("NMDS1", "NMDS2")]), ]
sub <- data.scores[data.scores$grp %in% data.scores$grp[1], ][chull(data.scores[data.scores$grp %in% data.scores$grp[1], c("NMDS1", "NMDS2")]), ]
length(data.scores$grp)
length(unique(data.scores$grp)
)
groups <- unique(data.scores$grp)
groups
sub <- data.scores[data.scores$grp %in% groups[1], ][chull(data.scores[data.scores$grp %in% groups[1], c("NMDS1", "NMDS2")]), ]
sapply(1:length(groups), function(i) data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ])
lapply(1:length(groups), function(i) data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ])
sapply(1:length(groups), function(i) {
df = data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ]
retunr(df)
})
return(df)
sapply(1:length(groups), function(i) {
df = data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ]
return(df)
})
hullDF <- sapply(1:length(groups), function(i) {
df = data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ]
return(df)
})
makeHullDF <- function(i) {
df = data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ]
return(df)
}
do.call("rbind", apply(1:length(groups), 1, makeHullDF))
do.call("rbind",sapply(1:length(groups), makeHullDF))
do.call("rbind", lapply(1:length(groups), makeHullDF))
do.call("rbind", lapply(1:length(groups), makeHullDF))
hullDF <- do.call("rbind", lapply(1:length(groups), makeHullDF))
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=grp,group=grp),alpha=0.30) + # add the convex hulls
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
hull.data <- do.call("rbind", lapply(1:length(groups), makeHullDF))
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=grp,group=grp),alpha=0.30) + # add the convex hulls
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
myNMDS <- metaMDS(youngDF[youngFishParas], distance = "euclidian")
myNMDS <- metaMDS(youngDF[youngFishParas], distance = "euclidian")
plot(myNMDS, type = "t")
# prettier with ggplot2
data.scores <- as.data.frame(scores(myNMDS))  #Using the scores function from vegan to extract the site scores and convert to a data.frame
data.scores$site <- rownames(data.scores)  # create a column of site names, from the rownames of data.scores
data.scores$grp <- youngDF$population
head(data.scores)  #look at the data
species.scores <- as.data.frame(scores(myNMDS, "species"))  #Using the scores function from vegan to extract the species scores and convert to a data.frame
species.scores$species <- rownames(species.scores)  # create a column of species, from the rownames of species.scores
head(species.scores)  #look at the data
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
groups <- unique(data.scores$grp)
sub <- data.scores[data.scores$grp %in% groups[1], ][chull(data.scores[data.scores$grp %in% groups[1], c("NMDS1", "NMDS2")]), ]
makeHullDF <- function(i) {
df = data.scores[data.scores$grp %in% groups[i], ][chull(data.scores[data.scores$grp %in% groups[i], c("NMDS1", "NMDS2")]), ]
return(df)
}
hull.data <- do.call("rbind", lapply(1:length(groups), makeHullDF))
ggplot() +
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),alpha=0.5) +  # add the species labels
geom_polygon(data=hull.data,aes(x=NMDS1,y=NMDS2,fill=grp,group=grp),alpha=0.30) + # add the convex hulls
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=grp),size=3) + # add the point markers
geom_text(data=data.scores,aes(x=NMDS1,y=NMDS2,label=site),size=2,vjust=0) +  # add the site labels
coord_equal() +
theme_bw()
---
title: "R Notebook"
output: html_notebook
---
# 1. Sequencing of bisulfite-converted DNA
))
## Analyses
## A. Balard
## November 2021
library(plyr) # for join (keep row order)
library(dendextend) # The package dendextend contains many functions for changing the appearance of a dendrogram and for comparing dendrograms.
library(ggplot2)
library(ggsignif) ## for significance bars on ggplot
library(lme4) ## for mixed models
library(nlme) ## for mixed models
library(tidyverse)
library(emmeans) ## for post-hoc Tukey tests
library(genepop) ## for epi-Fst
library(adegenet) ## for epi-Fst
library(poppr) # to handle missing data in epi-SNP ("missingno")
library(hierfstat) # to calculate heterozygosity
library(RColorBrewer)
# clear all objects
# rm(list = ls(all.names = TRUE))
## load custom functions
source("customRfunctions.R")
## Load previously united data (all 6 treatments)
## uniteCovALL: CpG covered in ALL individuals (has no NAs, useful for exploratory clustering analyses)
#load("/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/05MethylKit/output/uniteCovALL_woSexAndUnknownChr.RData")
## For further analyses: CpG covered in at least 2 then 6 individuals per group
#load("/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/05MethylKit/output/uniteCov2_woSexAndUnknownChr.RData")
# load("../../gitignore/output/uniteCov2_woSexAndUnknownChr.RData")
#load("/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/05MethylKit/output/uniteCov6_woSexAndUnknowChr.RData")
## Load samples metadata
## Metylation metadata merged with Kostas files
fullMetadata <- read.csv("../../data/fullMetadata137_Alice.csv")
## relevel treatments for graphs
fullMetadata$trtG1G2 <- factor(as.factor(fullMetadata$trtG1G2), levels = c("Control", "Exposed","NE_control", "NE_exposed", "E_control", "E_exposed"  ))
## family as factor for models
fullMetadata$Family <- as.factor(fullMetadata$Family)
#####################################################################
## Compare fitness traits between the different offsprings groups ###
## Follow up of Sagonas 2020 & Ferre Ortega's master's dissertation #
#####################################################################
fullMetadata_offs <- fullMetadata[fullMetadata$Generat %in% "O",]
fullMetadata_offs$trtG1G2 <- droplevels(fullMetadata_offs$trtG1G2)
## Create variable for offsping and parents separated
fullMetadata_offs$offsTrt <- "controlO"
fullMetadata_offs$offsTrt[fullMetadata_offs$Tr %in% c("TT", "CT")] <- "infectedO"
fullMetadata_offs$patTrt <- "controlP"
fullMetadata_offs$patTrt[fullMetadata_offs$Tr %in% c("TC", "TT")] <- "infectedP"
## Sanity check
table(fullMetadata_offs$offsTrt, fullMetadata_offs$trtG1G2)
table(fullMetadata_offs$patTrt, fullMetadata_offs$trtG1G2)
## Kaufmann et al. 2014: Body condition of the G2 fish, an estimate of fish health and a predictor
# of energy reserves and reproductive success, was calculated using there residuals from the
# regression of body mass on body length (Chellappaet al.1995).
fullMetadata_offs$BCI <- residuals(lmer(Wnettofin ~ Slfin * Sex + (1|Family), data=fullMetadata_offs))
## Effect of paternal treatment on body condition of offspring:
## Kaufmann et al. 2014:
# To investigate in which way paternal G1 exposure affected offspring tolerance,
# we tested how the relationship between G2 body condition and infection intensity
# was affected by paternal G1 exposure. This was tested in a linear mixed model on
# G2 body condition with paternal G1 treatment and the interaction between
# paternal G1 treatment and G2 infection intensity as fixed effects. Maternal
# half-sibship identity was set as a random effect
## Effect of paternal exposure on tolerance:
modTol <- lme(BCI ~ patTrt + patTrt:No.Worms,random=~1|Family,data=fullMetadata_offs)
anova(modTol)
## Or modTol <- lme(BCI ~ patTrt*No.Worms,random=~1|Family,data=fullMetadata_offs)
myBCdf <- fullMetadata_offs %>% group_by(patTrt, No.Worms) %>%
summarise(BCI = mean(BCI)) %>% data.frame()
ggplot(fullMetadata_offs, aes(x=No.Worms, y = BCI, group = patTrt, col = patTrt))+
geom_point() + geom_line(data=myBCdf)+
geom_point(data=myBCdf, aes(fill = patTrt), col = "black", size = 3, pch = 21)+
scale_color_manual(values = c("gray", "red"))+
scale_fill_manual(values = c("gray", "red"))+
theme_bw()
## Effect of treatment groups of offspring on body condition:
## Kaufmann et al. 2014:
# The linear mixed effect model (nlme function in R) included G2 body condition as dependent variable,
# sex, G2 treatment (exposed vs. control), paternal G1 treatment (exposed vs. control)
# and their interactions as fixed effects as well as maternal G2 half-sibship identity as a random effect
mod1 <- lme(BCI ~ offsTrt * patTrt, random=~1|Family,data=fullMetadata_offs)
anova(mod1) # strong significant effect of both offspring trt & paternal + interactions
mod1.2 <- lme(BCI ~  trtG1G2, random=~1|Family,data=fullMetadata_offs)
## pairwise posthoc test
emmeans(mod1.2, list(pairwise ~ trtG1G2), adjust = "tukey")
## Control father - treatment offspring has a strongly significantly lower BC than
## every other group, same as Kaufmann et al. 2014
plot <- ggplot(fullMetadata_offs, aes(x=trtG1G2, y = BCI))+
geom_boxplot()+
geom_signif(comparisons = list(c("NE_control", "NE_exposed")),
map_signif_level=TRUE, annotations="***",
y_position = 150, tip_length = 0, vjust=0.4) +
geom_signif(comparisons = list(c("NE_exposed", "E_control")),
map_signif_level=TRUE, annotations="***",
y_position = 200, tip_length = 0, vjust=0.4) +
geom_signif(comparisons = list(c("NE_exposed", "E_exposed")),
map_signif_level=TRUE, annotations="***",
y_position = 250, tip_length = 0, vjust=0.4) +
theme_bw()
pdf(file = "../../data/fig/BCIoffspring.pdf")
plot
dev.off()
#######################################################
## Nbr/Ratio of Methylated Sites in different groups ##
#######################################################
## Nbr samples: 137
nrow(fullMetadata)
# Mean nbr of million reads: 11.2
mean(fullMetadata$M.Seqs_rawReads)
# 95% confidence interval: 0.35
qnorm(0.975)*sd(fullMetadata$M.Seqs_rawReads)/sqrt(nrow(fullMetadata))
# Average mapping efficiency +/-SD = 85.5% +/-0.47
mean(fullMetadata$MappingEfficiency.BSBoldvsGynogen)
qnorm(0.975)*sd(fullMetadata$MappingEfficiency.BSBoldvsGynogen)/sqrt(nrow(fullMetadata))
########################
## Calculate (1) Mfr per site, (2) biallelic equivalent, (3) epi-Fst and epi-FIS and (4) number of methylated sites in uniteCov2 (CpG shared by at least 2 fish, after filtering and normalising)
## (1) Mfr per site
reRun= FALSE
if(reRun == TRUE){
df <- methylKit::getData(uniteCov2_woSexAndUnknowChr)
MfrData2 <- data.frame(matrix(ncol=137, nrow=nrow(df)))
namevector <- paste0("Mfr", 1:137)
vector <- 1:137
for(i in vector){
colnames(MfrData2)[i] <- namevector[i]
MfrData2[i] <- df[paste0("numCs", i)]/df[paste0("coverage", i)]
}
}
## (2) biallelic equivalent
### Sagonas et al. 2020 MBE " A  number  of  methylated  sites/regions  were  estimated by converting the MFr into ordinal data: sites/regionswith little or no methylation (MFr<30%) were annotated as0  and  treated  as  no  methylated  sites/regions,  sites/regionswith  intermediate  methylation  levels  (30%<MFr<70%)were considered as heterozygote sites/regions and convertedinto  1,  whereas  sites/regions  with  high  or  fixed  methylation(MFr>70%) were treated as homozygous at this site/regionsand were annotated as 2."
rerun= FALSE
if(rerun == TRUE){
print("long part started, needs ~10min")
getBiallVal <- function(x){
y=NA
if(x <= 0.3 & !is.na(x)){
y = "00"
} else if(x > 0.3 & x < 0.7 & !is.na(x)){
y = "01"
} else if(x >= 0.7 & !is.na(x)){
y = "11"
}
return(y)
}
getBiallValVec <- function(vec){sapply(vec, getBiallVal)}
system.time(
MbiallData2 <- sapply(MfrData2, function(x) {getBiallValVec(x)})
)
#### Saving point ####
save(MfrData2, MbiallData2, file = "../../gitignore/output/MethylationFrequency_2fishmin.RData")
print("long truc saved")
}
#### Load data : MfrData2 & MbiallData2 ####
#load(file = "../../gitignore/output/MethylationFrequency_2fishmin.RData")
## rename correctly the full biallelic dataframe:
colnames(MbiallData2) <- uniteCov2_woSexAndUnknowChr@sample.ids
#### Load data : MfrData2 & MbiallData2 ####
load(file = "../../gitignore/output/MethylationFrequency_2fishmin.RData")
setwd("Documents/pro/Git/StickParaOffsBroject/code/R")
uniteCov6_G1_woSexAndUnknowChrOVERLAP
## Alice Balard
## 4 Feb 2022
## NB: change the files to load each time R01.2 prep methylkit object is relaunched.
## Don't forget the timestamp to not mix up big files
## change path depending on the machine
if (machine=="apocrita"){
mypath = "/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/05MethylKit/output/"
} else if (machine=="mythinkpad"){
mypath = "~/Documents/pro/Git/StickParaOffsBroject/gitignore/bigdata/05MethylKit/output/"
}
## Load previously united data (all 6 treatments)
## uniteCovALL: CpG covered in ALL individuals (has no NAs, useful for exploratory clustering analyses)
base::load(paste0(mypath, "uniteCovALL_woSexAndUnknownChr_10feb22.RData"))
## rename
#fullMethylKitObj = uniteCovALL_woSexAndUnknowChr; rm(uniteCovALL_woSexAndUnknowChr)
## Load previously united data for PARENTS
# CpG covered in ALL parents
base::load(paste0(mypath, "uniteCovALL_G1_woSexAndUnknownChr_10feb22.RData"))
## CpG covered in 50% of individuals (6)
base::load(paste0(mypath, "uniteCov6_G1_woSexAndUnknownChr_10feb22.RData"))
## Load previously united data for OFFSPRINGS
## CpG covered in 50% of individuals (14)
base::load(paste0(mypath, "uniteCov14_G2_woSexAndUnknownChr_10feb22.RData"))
# CpG covered in ALL offsprings
base::load(paste0(mypath, "uniteCovALL_G2_woSexAndUnknownChr_10feb22.RData"))
## How many CpGs are covered in each dataset?
nrow(uniteCovALL_woSexAndUnknowChr) # 55 530
nrow(uniteCovALL_G1_woSexAndUnknowChr) # 148 860
nrow(uniteCovALL_G2_woSexAndUnknowChr) # 78 384
nrow(uniteCov6_G1_woSexAndUnknowChr) # 1 188 179
nrow(uniteCov14_G2_woSexAndUnknowChr) # 1 050 222
machine=="mythinkpad"
machine="mythinkpad"
## Alice Balard
## 4 Feb 2022
## NB: change the files to load each time R01.2 prep methylkit object is relaunched.
## Don't forget the timestamp to not mix up big files
## change path depending on the machine
if (machine=="apocrita"){
mypath = "/data/SBCS-EizaguirreLab/Alice/StickParaBroOff/Data/05MethylKit/output/"
} else if (machine=="mythinkpad"){
mypath = "~/Documents/pro/Git/StickParaOffsBroject/gitignore/bigdata/05MethylKit/output/"
}
## Load previously united data (all 6 treatments)
## uniteCovALL: CpG covered in ALL individuals (has no NAs, useful for exploratory clustering analyses)
base::load(paste0(mypath, "uniteCovALL_woSexAndUnknownChr_10feb22.RData"))
## rename
#fullMethylKitObj = uniteCovALL_woSexAndUnknowChr; rm(uniteCovALL_woSexAndUnknowChr)
## Load previously united data for PARENTS
# CpG covered in ALL parents
base::load(paste0(mypath, "uniteCovALL_G1_woSexAndUnknownChr_10feb22.RData"))
## CpG covered in 50% of individuals (6)
base::load(paste0(mypath, "uniteCov6_G1_woSexAndUnknownChr_10feb22.RData"))
## Load previously united data for OFFSPRINGS
## CpG covered in 50% of individuals (14)
base::load(paste0(mypath, "uniteCov14_G2_woSexAndUnknownChr_10feb22.RData"))
# CpG covered in ALL offsprings
base::load(paste0(mypath, "uniteCovALL_G2_woSexAndUnknownChr_10feb22.RData"))
## How many CpGs are covered in each dataset?
nrow(uniteCovALL_woSexAndUnknowChr) # 55 530
nrow(uniteCovALL_G1_woSexAndUnknowChr) # 148 860
nrow(uniteCovALL_G2_woSexAndUnknowChr) # 78 384
nrow(uniteCov6_G1_woSexAndUnknowChr) # 1 188 179
nrow(uniteCov14_G2_woSexAndUnknowChr) # 1 050 222
######################################################################################################
## consider only methylKit object (uniteCov) with OVERLAPPING positions in Parents G1 and Offspring G2
overlappingCpG_G1G2df <- findOverlaps(as(uniteCov6_G1_woSexAndUnknowChr,"GRanges"),
as(uniteCov14_G2_woSexAndUnknowChr,"GRanges"))
## load all libraries needed for the project
library(plyr) # for join (keep row order)
library(dendextend) # The package dendextend contains many functions for changing the appearance of a dendrogram and for comparing dendrograms.
library(ggplot2)
library(ggsignif) ## for significance bars on ggplot
library(lme4) ## for mixed models
library(nlme) ## for mixed models
library(tidyverse)
library(emmeans) ## for post-hoc Tukey tests
library(methylKit)
library(vegan) ## for Adonis
library(genomation) ## for annotation
# BiocManager::install("GenomicFeatures")
library(GenomicFeatures) ## for annotation
library(tidyverse)     # tidyverse will pull in ggplot2, readr, other useful libraries
library(magrittr)      # provides the %>% operator
#BiocManager::install("WGCNA")
library(WGCNA)
library(ggpubr) ## to merge ggplot2 plots
theme_set(theme_pubr())
library(goeveg) # find the best number of dimensions for NMDS
library(VennDiagram)
library(RColorBrewer) # for colors in Venn diagrams
library(lmtest) # for lrtests
library(ggeffects) # to plot random effects predictions
## offspring colors for all kind of plots
colOffs <- c("#ffe67f", "#ff6300","#a8caff","#a800d4")
######################################################################################################
## consider only methylKit object (uniteCov) with OVERLAPPING positions in Parents G1 and Offspring G2
overlappingCpG_G1G2df <- findOverlaps(as(uniteCov6_G1_woSexAndUnknowChr,"GRanges"),
as(uniteCov14_G2_woSexAndUnknowChr,"GRanges"))
overlappingCpG_G1G2df <- data.frame(overlappingCpG_G1G2df)
uniteCov6_G1_woSexAndUnknowChrOVERLAP <- uniteCov6_G1_woSexAndUnknowChr[overlappingCpG_G1G2df$queryHits,]
uniteCov14_G2_woSexAndUnknowChrOVERLAP <- uniteCov14_G2_woSexAndUnknowChr[overlappingCpG_G1G2df$subjectHits,]
uniteCov6_G1_woSexAndUnknowChrOVERLAP
uniteCov14_G2_woSexAndUnknowChrOVERLAP
save(uniteCov6_G1_woSexAndUnknowChrOVERLAP=uniteCov6_G1_woSexAndUnknowChrOVERLAP,
uniteCov14_G2_woSexAndUnknowChrOVERLAP=uniteCov14_G2_woSexAndUnknowChrOVERLAP,
file = "~/Documents/pro/Git/StickParaOffsBroject/gitignore/bigdata/05MethylKit/output/uniteCovhalf_FINAL.RData")
# TEST
load("~/Documents/pro/Git/StickParaOffsBroject/gitignore/bigdata/05MethylKit/output/uniteCovhalf_FINAL.RData")
uniteCov14_G2
uniteCov14_G2_woSexAndUnknowChrOVERLAP
